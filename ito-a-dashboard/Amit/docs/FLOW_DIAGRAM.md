# Dynamic CSV Analysis - Visual Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER UPLOADS CSV FILE                                â”‚
â”‚                    POST /api/upload/dynamic-analysis/{channel_type}     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: DATA PROFILING                                          ğŸ“Š     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Load CSV into Pandas DataFrame                                       â”‚
â”‚  â€¢ Extract column names: ["date", "clicks", "impressions", "ctr"]       â”‚
â”‚  â€¢ Get data types: {clicks: int64, ctr: float64, ...}                   â”‚
â”‚  â€¢ Calculate statistics: {clicks: {min: 10, max: 500, mean: 150}}       â”‚
â”‚  â€¢ Sample first 3 rows for context                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: COLUMN INTERPRETATION (Gemini AI Call #1)              ğŸ¤–     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PROMPT TO GEMINI:                                                      â”‚
â”‚  "You are a data analyst. Analyze this CSV schema..."                   â”‚
â”‚                                                                          â”‚
â”‚  INPUT: Column names, types, sample data                                â”‚
â”‚                                                                          â”‚
â”‚  GEMINI ANALYZES...                                                     â”‚
â”‚                                                                          â”‚
â”‚  OUTPUT (JSON):                                                         â”‚
â”‚  {                                                                       â”‚
â”‚    "columns": {                                                          â”‚
â”‚      "date": {                                                           â”‚
â”‚        "meaning": "Campaign or posting date",                            â”‚
â”‚        "type": "dimension",                                              â”‚
â”‚        "category": "date"                                                â”‚
â”‚      },                                                                  â”‚
â”‚      "clicks": {                                                         â”‚
â”‚        "meaning": "Number of user clicks",                               â”‚
â”‚        "type": "measure",                                                â”‚
â”‚        "category": "engagement"                                          â”‚
â”‚      }                                                                   â”‚
â”‚    },                                                                    â”‚
â”‚    "primary_date_column": "date",                                        â”‚
â”‚    "key_metrics": ["clicks", "impressions", "ctr"]                       â”‚
â”‚  }                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: DASHBOARD DESIGN (Gemini AI Call #2)               ğŸ¨         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PROMPT TO GEMINI:                                                      â”‚
â”‚  "You are a BI dashboard designer. Based on this interpreted schema..." â”‚
â”‚                                                                          â”‚
â”‚  INPUT: Column interpretations from Step 2                              â”‚
â”‚                                                                          â”‚
â”‚  GEMINI DESIGNS...                                                      â”‚
â”‚                                                                          â”‚
â”‚  OUTPUT (JSON):                                                         â”‚
â”‚  {                                                                       â”‚
â”‚    "kpis": [                                                             â”‚
â”‚      {                                                                   â”‚
â”‚        "name": "Total Clicks",                                           â”‚
â”‚        "description": "Sum of all clicks",                               â”‚
â”‚        "calculation": "sum of clicks",                                   â”‚
â”‚        "columns_needed": ["clicks"],                                     â”‚
â”‚        "format": "number"                                                â”‚
â”‚      },                                                                  â”‚
â”‚      {                                                                   â”‚
â”‚        "name": "Average CTR",                                            â”‚
â”‚        "calculation": "average of ctr",                                  â”‚
â”‚        "format": "percentage"                                            â”‚
â”‚      }                                                                   â”‚
â”‚    ],                                                                    â”‚
â”‚    "charts": [                                                           â”‚
â”‚      {                                                                   â”‚
â”‚        "title": "Clicks Over Time",                                      â”‚
â”‚        "chart_type": "line",                                             â”‚
â”‚        "x_axis": "date",                                                 â”‚
â”‚        "y_axis": "clicks",                                               â”‚
â”‚        "grouping": "date",                                               â”‚
â”‚        "aggregation": "sum"                                              â”‚
â”‚      },                                                                  â”‚
â”‚      {                                                                   â”‚
â”‚        "title": "Top Campaigns",                                         â”‚
â”‚        "chart_type": "bar",                                              â”‚
â”‚        "x_axis": "campaign_name",                                        â”‚
â”‚        "y_axis": "clicks"                                                â”‚
â”‚      }                                                                   â”‚
â”‚    ]                                                                     â”‚
â”‚  }                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: DATA CALCULATIONS (Pandas Execution)               ğŸ§®         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EXECUTE THE AI'S PLAN:                                                 â”‚
â”‚                                                                          â”‚
â”‚  KPI Calculations:                                                      â”‚
â”‚  â€¢ Total Clicks = df['clicks'].sum() â†’ 15,432                           â”‚
â”‚  â€¢ Average CTR = df['ctr'].mean() â†’ 3.42                                â”‚
â”‚  â€¢ Total Impressions = df['impressions'].sum() â†’ 451,890                â”‚
â”‚                                                                          â”‚
â”‚  Chart Data Preparation:                                                â”‚
â”‚  â€¢ Clicks Over Time:                                                    â”‚
â”‚      grouped = df.groupby('date')['clicks'].sum()                       â”‚
â”‚      â†’ [{"label": "2024-01-01", "value": 1250}, ...]                    â”‚
â”‚                                                                          â”‚
â”‚  â€¢ Top Campaigns:                                                       â”‚
â”‚      top_10 = df.nlargest(10, 'clicks')                                 â”‚
â”‚      â†’ [{"label": "Campaign A", "value": 5000}, ...]                    â”‚
â”‚                                                                          â”‚
â”‚  OUTPUT:                                                                â”‚
â”‚  {                                                                       â”‚
â”‚    "kpis": {                                                             â”‚
â”‚      "Total Clicks": 15432.0,                                            â”‚
â”‚      "Average CTR": 3.42                                                 â”‚
â”‚    },                                                                    â”‚
â”‚    "charts": [                                                           â”‚
â”‚      {                                                                   â”‚
â”‚        "title": "Clicks Over Time",                                      â”‚
â”‚        "type": "line",                                                   â”‚
â”‚        "data": [{"label": "2024-01-01", "value": 1250}, ...]            â”‚
â”‚      }                                                                   â”‚
â”‚    ]                                                                     â”‚
â”‚  }                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: GENERATE RECOMMENDATIONS (Gemini AI Call #3)       ğŸ’¡         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CALL: recommender.py â†’ get_gemini_recommendations()                   â”‚
â”‚                                                                          â”‚
â”‚  PROMPT TO GEMINI:                                                      â”‚
â”‚  "You are a marketing analyst. Based on this data summary..."           â”‚
â”‚                                                                          â”‚
â”‚  INPUT:                                                                 â”‚
â”‚  Channel: seo                                                            â”‚
â”‚  Total Clicks: 15432                                                     â”‚
â”‚  Average CTR: 3.42%                                                      â”‚
â”‚  Total Impressions: 451890                                               â”‚
â”‚                                                                          â”‚
â”‚  GEMINI GENERATES...                                                    â”‚
â”‚                                                                          â”‚
â”‚  OUTPUT (List of strings):                                              â”‚
â”‚  [                                                                       â”‚
â”‚    "Focus on 'best crm software' keyword - it's ranking #1 with         â”‚
â”‚     highest clicks (1218 total). Continue creating content around       â”‚
â”‚     this topic.",                                                        â”‚
â”‚                                                                          â”‚
â”‚    "Improve CTR for keywords ranking 10-15. Your average CTR of 3.42%   â”‚
â”‚     is strong, but these mid-ranking keywords have opportunity for      â”‚
â”‚     better meta descriptions.",                                          â”‚
â”‚                                                                          â”‚
â”‚    "Consider targeting long-tail variations. Analysis shows your        â”‚
â”‚     top-performing content generates 3x more clicks, indicating         â”‚
â”‚     opportunity in niche targeting."                                     â”‚
â”‚  ]                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: ASSEMBLE FINAL RESPONSE                             ğŸ“¦         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  COMBINE ALL RESULTS:                                                   â”‚
â”‚                                                                          â”‚
â”‚  {                                                                       â”‚
â”‚    "channel_type": "seo",                                                â”‚
â”‚    "file_name": "sample_seo_data.csv",                                   â”‚
â”‚    "total_records": 21,                                                  â”‚
â”‚                                                                          â”‚
â”‚    "column_interpretation": { ... from Step 2 ... },                    â”‚
â”‚                                                                          â”‚
â”‚    "dashboard_design": { ... from Step 3 ... },                         â”‚
â”‚                                                                          â”‚
â”‚    "kpis": { ... from Step 4 ... },                                     â”‚
â”‚                                                                          â”‚
â”‚    "charts": [ ... from Step 4 ... ],                                   â”‚
â”‚                                                                          â”‚
â”‚    "recommendations": [ ... from Step 5 ... ],                          â”‚
â”‚                                                                          â”‚
â”‚    "success": true,                                                      â”‚
â”‚    "message": "Successfully analyzed sample_seo_data.csv..."             â”‚
â”‚  }                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RETURN COMPREHENSIVE JSON TO USER                    â”‚
â”‚                    Status: 200 OK                                       â”‚
â”‚                    Processing Time: 10-20 seconds                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Timeline Breakdown

```
0s    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ CSV     â”‚ User uploads file
      â”‚ Upload  â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
           â”‚
1s    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
      â”‚ Step 1  â”‚ Load CSV, profile data
      â”‚ Profile â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
           â”‚
3s    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Step 2      â”‚ Gemini Call #1
      â”‚ AI Interpretâ”‚ (Column meanings)
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
8s    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Step 3      â”‚ Gemini Call #2
      â”‚ AI Design   â”‚ (Dashboard plan)
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
14s   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Step 4      â”‚ Pandas calculations
      â”‚ Calculate   â”‚ (Execute AI's plan)
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
16s   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Step 5      â”‚ Gemini Call #3
      â”‚ AI Recommendâ”‚ (Insights)
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
20s   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Step 6      â”‚ Assemble response
      â”‚ Assembly    â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
      â”‚ Return  â”‚ JSON response to user
      â”‚ Result  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CSV File  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Pandas DataFrame                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ date  â”‚ clicks â”‚ impressions â”‚ ctr     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ 01-01 â”‚  125   â”‚   4500      â”‚ 2.78   â”‚  â”‚
â”‚  â”‚ 01-02 â”‚  142   â”‚   4800      â”‚ 2.96   â”‚  â”‚
â”‚  â”‚ 01-03 â”‚  165   â”‚   5200      â”‚ 3.17   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                  â”‚                  â”‚                  â”‚
       â–¼                  â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Column     â”‚   â”‚  Dashboard  â”‚   â”‚  KPI        â”‚   â”‚  Chart      â”‚
â”‚  Schema     â”‚   â”‚  Design     â”‚   â”‚  Values     â”‚   â”‚  Data       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ date: dim   â”‚   â”‚ KPI: Total  â”‚   â”‚ Total Clicksâ”‚   â”‚ Line Chart: â”‚
â”‚ clicks: msr â”‚   â”‚   Clicks    â”‚   â”‚ = 15,432    â”‚   â”‚  [1250,     â”‚
â”‚ ctr: msr    â”‚   â”‚             â”‚   â”‚             â”‚   â”‚   1380, ...]â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚ Chart: Line â”‚   â”‚ Avg CTR     â”‚   â”‚             â”‚
       â”‚          â”‚   Over Time â”‚   â”‚ = 3.42%     â”‚   â”‚ Bar Chart:  â”‚
       â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚  [5000,     â”‚
       â”‚                 â”‚                 â”‚          â”‚   3200, ...]â”‚
       â”‚                 â”‚                 â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚                 â”‚
       â–¼                 â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 GEMINI AI PROCESSING                               â”‚
â”‚                                                                    â”‚
â”‚  Call #1: Interpret  â†’  Call #2: Design  â†’  Call #3: Recommend   â”‚
â”‚                                                                    â”‚
â”‚  "clicks means      "Total Clicks KPI     "Focus on top          â”‚
â”‚   engagement"        should be sum"        performing keywords"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚   FINAL JSON RESPONSE    â”‚
                               â”‚                          â”‚
                               â”‚  â€¢ Interpretations       â”‚
                               â”‚  â€¢ Dashboard Design      â”‚
                               â”‚  â€¢ Calculated KPIs       â”‚
                               â”‚  â€¢ Chart Data Arrays     â”‚
                               â”‚  â€¢ AI Recommendations    â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FastAPI          â”‚
â”‚   Endpoint         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                     â”‚
          â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Pandas        â”‚                  â”‚  Google Gemini   â”‚
â”‚   Library       â”‚                  â”‚  API (3 calls)   â”‚
â”‚                 â”‚                  â”‚                  â”‚
â”‚ â€¢ Read CSV      â”‚                  â”‚ â€¢ Call #1:       â”‚
â”‚ â€¢ Profile data  â”‚                  â”‚   Interpret      â”‚
â”‚ â€¢ Calculate     â”‚                  â”‚                  â”‚
â”‚ â€¢ Aggregate     â”‚                  â”‚ â€¢ Call #2:       â”‚
â”‚ â€¢ Group by      â”‚                  â”‚   Design         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚                  â”‚
                                     â”‚ â€¢ Call #3:       â”‚
                                     â”‚   Recommend      â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                     â”‚
          â”‚                                     â”‚
          â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              recommender.py                            â”‚
â”‚  (Existing AI recommendation function)                 â”‚
â”‚                                                         â”‚
â”‚  â€¢ Creates marketing-focused prompts                   â”‚
â”‚  â€¢ Calls Gemini with data summary                      â”‚
â”‚  â€¢ Parses AI response into list of strings             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DynamicAnalysisResponse                        â”‚
â”‚         (Pydantic Model)                               â”‚
â”‚                                                         â”‚
â”‚  â€¢ Validates all fields                                â”‚
â”‚  â€¢ Ensures type safety                                 â”‚
â”‚  â€¢ Serializes to JSON                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Try Process â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
    Success? â”€â”€â”€â”€â”€â”€ Yes â”€â”€â”€â”€â”€â”€â–º Return Result
       â”‚
       No
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Which Step Failed?                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  Step 2 (AI Interpret):                 â”‚
â”‚    â†’ Use basic type detection           â”‚
â”‚    â†’ Numeric = measure, text = dimensionâ”‚
â”‚                                          â”‚
â”‚  Step 3 (AI Design):                    â”‚
â”‚    â†’ Create default KPI (Total Records) â”‚
â”‚    â†’ Create simple bar chart            â”‚
â”‚                                          â”‚
â”‚  Step 4 (Calculate):                    â”‚
â”‚    â†’ Skip invalid columns               â”‚
â”‚    â†’ Log warning, continue              â”‚
â”‚                                          â”‚
â”‚  Step 5 (Recommend):                    â”‚
â”‚    â†’ Return generic best practices      â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Log Error   â”‚
      â”‚ Return 500  â”‚
      â”‚ with Detail â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Decision Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Is CSV valid UTF-8?                       â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Yes                          â”‚ No
    â–¼                              â–¼
Continue                    Return 400 Error


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Does CSV have headers?                    â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Yes                          â”‚ No
    â–¼                              â–¼
Continue                    Use Column1, Column2...


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Did AI return valid JSON?                 â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Yes                          â”‚ No
    â–¼                              â–¼
Use AI Output               Use Fallback Logic


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Do referenced columns exist?              â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Yes                          â”‚ No
    â–¼                              â–¼
Calculate KPI               Skip KPI, Log Warning
```

---

**End of Visual Flow Documentation**

This diagram shows how a simple CSV upload triggers a sophisticated 6-step AI-powered analysis pipeline! ğŸš€
